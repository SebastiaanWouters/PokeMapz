/*
 pogomap 2017-02-17 
*/

"use strict";function excludePokemon(a){$selectExclude.val($selectExclude.val().concat(a)).trigger("change")}function notifyAboutPokemon(a){$selectPokemonNotify.val($selectPokemonNotify.val().concat(a)).trigger("change")}function removePokemonMarker(a){mapData.pokemons[a].marker.rangeCircle&&(mapData.pokemons[a].marker.rangeCircle.setMap(null),delete mapData.pokemons[a].marker.rangeCircle),mapData.pokemons[a].marker.setMap(null),mapData.pokemons[a].hidden=!0}function initMap(){map=new google.maps.Map(document.getElementById("map"),{center:{lat:centerLat,lng:centerLng},zoom:Store.get("zoomLevel"),fullscreenControl:!0,streetViewControl:!1,mapTypeControl:!1,clickableIcons:!1,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.DROPDOWN_MENU,position:google.maps.ControlPosition.RIGHT_TOP,mapTypeIds:[google.maps.MapTypeId.ROADMAP,google.maps.MapTypeId.SATELLITE,google.maps.MapTypeId.HYBRID,"nolabels_style","dark_style","style_light2","style_pgo","dark_style_nl","style_light2_nl","style_pgo_nl","style_pgo_day","style_pgo_night","style_pgo_dynamic"]}});var a=new google.maps.StyledMapType(noLabelsStyle,{name:"No Labels"});map.mapTypes.set("nolabels_style",a);var b=new google.maps.StyledMapType(darkStyle,{name:"Dark"});map.mapTypes.set("dark_style",b);var c=new google.maps.StyledMapType(light2Style,{name:"Light2"});map.mapTypes.set("style_light2",c);var d=new google.maps.StyledMapType(pGoStyle,{name:"PokemonGo"});map.mapTypes.set("style_pgo",d);var e=new google.maps.StyledMapType(darkStyleNoLabels,{name:"Dark (No Labels)"});map.mapTypes.set("dark_style_nl",e);var f=new google.maps.StyledMapType(light2StyleNoLabels,{name:"Light2 (No Labels)"});map.mapTypes.set("style_light2_nl",f);var g=new google.maps.StyledMapType(pGoStyleNoLabels,{name:"PokemonGo (No Labels)"});map.mapTypes.set("style_pgo_nl",g);var h=new google.maps.StyledMapType(pGoStyleDay,{name:"PokemonGo Day"});map.mapTypes.set("style_pgo_day",h);var i=new google.maps.StyledMapType(pGoStyleNight,{name:"PokemonGo Night"});map.mapTypes.set("style_pgo_night",i);var j=new Date,k=j.getHours(),l=k>=6&&k<19?h:i;map.mapTypes.set("style_pgo_dynamic",l),map.addListener("maptypeid_changed",function(a){Store.set("map_style",this.mapTypeId)}),map.setMapTypeId(Store.get("map_style")),map.addListener("idle",updateMap),map.addListener("zoom_changed",function(){storeZoom===!0?Store.set("zoomLevel",this.getZoom()):storeZoom=!0,redrawPokemon(mapData.pokemons),redrawPokemon(mapData.lurePokemons)}),searchMarker=createSearchMarker(),locationMarker=createLocationMarker(),createMyLocationButton(),initSidebar(),$("#scan-here").on("click",function(){var a=map.getCenter();changeLocation(a.lat(),a.lng()),$("#search-switch").checked||($("#search-switch").prop("checked",!0),searchControl("on"))})}function updateLocationMarker(a){return a in searchMarkerStyles&&(locationMarker.setIcon(searchMarkerStyles[a].icon),Store.set("locationMarkerStyle",a)),locationMarker}function createLocationMarker(){var a=Store.get("followMyLocationPosition"),b="lat"in a?a.lat:centerLat,c="lng"in a?a.lng:centerLng,d=new google.maps.Marker({map:map,animation:google.maps.Animation.DROP,position:{lat:b,lng:c},draggable:!0,icon:null,optimized:!1,zIndex:google.maps.Marker.MAX_ZINDEX+2});return d.infoWindow=new google.maps.InfoWindow({content:"<div><b>My Location</b></div>",disableAutoPan:!0}),addListeners(d),google.maps.event.addListener(d,"dragend",function(){var a=d.getPosition();Store.set("followMyLocationPosition",{lat:a.lat(),lng:a.lng()})}),d}function updateSearchMarker(a){return a in searchMarkerStyles&&(searchMarker.setIcon(searchMarkerStyles[a].icon),Store.set("searchMarkerStyle",a)),searchMarker}function createSearchMarker(){var a=new google.maps.Marker({position:{lat:centerLat,lng:centerLng},map:map,animation:google.maps.Animation.DROP,draggable:!Store.get("lockMarker"),icon:null,optimized:!1,zIndex:google.maps.Marker.MAX_ZINDEX+1});a.infoWindow=new google.maps.InfoWindow({content:"<div><b>Search Location</b></div>",disableAutoPan:!0}),addListeners(a);var b=null;return google.maps.event.addListener(a,"dragstart",function(){b=a.getPosition()}),google.maps.event.addListener(a,"dragend",function(){var c=a.getPosition();changeSearchLocation(c.lat(),c.lng()).done(function(){b=null}).fail(function(){b&&a.setPosition(b)})}),a}function searchControl(a){$.post(searchControlURI+"?action="+encodeURIComponent(a)),$("#scan-here").toggleClass("disabled","off"===a)}function updateSearchStatus(){$.getJSON(searchControlURI).then(function(a){$("#search-switch").prop("checked",a.status),$("#scan-here").toggleClass("disabled",!a.status)})}function initSidebar(){$("#gyms-switch").prop("checked",Store.get("showGyms")),$("#gym-sidebar-switch").prop("checked",Store.get("useGymSidebar")),$("#gym-sidebar-wrapper").toggle(Store.get("showGyms")),$("#gyms-filter-wrapper").toggle(Store.get("showGyms")),$("#team-gyms-only-switch").val(Store.get("showTeamGymsOnly")),$("#open-gyms-only-switch").val(Store.get("showOpenGymsOnly")),$("#min-level-gyms-filter-switch").val(Store.get("minGymLevel")),$("#max-level-gyms-filter-switch").val(Store.get("maxGymLevel")),$("#last-update-gyms-switch").val(Store.get("showLastUpdatedGymsOnly")),$("#pokemon-switch").prop("checked",Store.get("showPokemon")),$("#pokestops-switch").prop("checked",Store.get("showPokestops")),$("#lured-pokestops-only-switch").val(Store.get("showLuredPokestopsOnly")),$("#lured-pokestops-only-wrapper").toggle(Store.get("showPokestops")),$("#geoloc-switch").prop("checked",Store.get("geoLocate")),$("#lock-marker-switch").prop("checked",Store.get("lockMarker")),$("#start-at-user-location-switch").prop("checked",Store.get("startAtUserLocation")),$("#follow-my-location-switch").prop("checked",Store.get("followMyLocation")),$("#scan-here-switch").prop("checked",Store.get("scanHere")),$("#scan-here").toggle(Store.get("scanHere")),$("#scanned-switch").prop("checked",Store.get("showScanned")),$("#spawnpoints-switch").prop("checked",Store.get("showSpawnpoints")),$("#ranges-switch").prop("checked",Store.get("showRanges")),$("#sound-switch").prop("checked",Store.get("playSound"));var a=new google.maps.places.Autocomplete(document.getElementById("next-location"));$("#next-location").css("background-color",$("#geoloc-switch").prop("checked")?"#e0e0e0":"#ffffff"),updateSearchStatus(),setInterval(updateSearchStatus,5e3),a.addListener("place_changed",function(){var b=a.getPlace();if(b.geometry){var c=b.geometry.location;changeLocation(c.lat(),c.lng())}}),$("#pokemon-icon-size").val(Store.get("iconSizeModifier"))}function pad(a){return a<=99?("0"+a).slice(-2):a}function getTypeSpan(a){return"<span style='padding: 2px 5px; text-transform: uppercase; color: white; margin-right: 2px; border-radius: 4px; font-size: 0.8em; vertical-align: text-bottom; background-color: "+a.color+"'>"+a.type+"</span>"}function openMapDirections(a,b){var c="https://www.google.com/maps/?daddr="+a+","+b;window.open(c,"_blank")}function pokemonLabel(a,b,c,d,e,f,g,h,i,j,k,l,m){var n=new Date(d),o=b?"("+b+")":"",p="";$.each(c,function(a,b){p+=getTypeSpan(b)});var q="";if(null!=i){var r=(i+j+k)/45*100;q="\n            <div>\n                IV: "+r.toFixed(1)+"% ("+i+"/"+j+"/"+k+")\n            </div>\n            <div>\n                Moves: "+i8ln(moves[l].name)+" / "+i8ln(moves[m].name)+"\n            </div>\n            "}var s="\n        <div>\n            <b>"+a+"</b>\n            <span> - </span>\n            <small>\n                <a href='http://www.pokemon.com/us/pokedex/"+e+"' target='_blank' title='View in Pokedex'>#"+e+"</a>\n            </small>\n            <span> "+o+"</span>\n            <span> - </span>\n            <small>"+p+"</small>\n        </div>\n        <div>\n            Disappears at "+pad(n.getHours())+":"+pad(n.getMinutes())+":"+pad(n.getSeconds())+"\n            <span class='label-countdown' disappears-at='"+d+"'>(00m00s)</span>\n        </div>\n        <div>\n            Location: "+f.toFixed(6)+", "+g.toFixed(7)+"\n        </div>\n            "+q+"\n        <div>\n            <a href='javascript:excludePokemon("+e+")'>Exclude</a>&nbsp;&nbsp\n            <a href='javascript:notifyAboutPokemon("+e+")'>Notify</a>&nbsp;&nbsp\n            <a href='javascript:removePokemonMarker(\""+h+"\")'>Remove</a>&nbsp;&nbsp\n            <a href='javascript:void(0);' onclick='javascript:openMapDirections("+f+","+g+");' title='View in Maps'>Get directions</a>\n        </div>";return s}function gymLabel(a,b,c,d,e){for(var f=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,g=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,h=arguments.length>7&&void 0!==arguments[7]?arguments[7]:[],i=arguments[8],j="",k=0;k<h.length;k++)j+='\n            <span class="gym-member" title="'+h[k].pokemon_name+" | "+h[k].trainer_name+" (Lvl "+h[k].trainer_level+')">\n                <i class="pokemon-sprite n'+h[k].pokemon_id+'"></i>\n                <span class="cp team-'+b+'">'+h[k].pokemon_cp+"</span>\n            </span>";var l;if(f){var m=new Date(f);l=m.getFullYear()+"-"+pad(m.getMonth()+1)+"-"+pad(m.getDate())+" "+pad(m.getHours())+":"+pad(m.getMinutes())+":"+pad(m.getSeconds())}else l="Unknown";var n="";Store.get("useGymSidebar")||(n="<div>\n                <a href='javascript:void(0);' onclick='javascript:openMapDirections("+d+","+e+");' title='View in Maps'>Get directions</a>\n            </div>");var o=g?"<div>"+g+"</div>":"",p=["0, 0, 0, .4","74, 138, 202, .6","240, 68, 58, .6","254, 217, 40, .6"],q;if(0===b)q="\n            <div>\n                <center>\n                    <div>\n                        <b style='color:rgba("+p[b]+")'>"+a+"</b><br>\n                        <img height='70px' style='padding: 5px;' src='static/forts/"+a+"_large.png'>\n                    </div>\n                    "+o+"\n                    <div>\n                        Location: "+d.toFixed(6)+", "+e.toFixed(7)+"\n                    </div>\n                    <div>\n                        Last Scanned: "+l+"\n                    </div>\n                    "+n+"\n                </center>\n            </div>";else{var r=getGymLevel(c);q="\n            <div>\n                <center>\n                    <div style='padding-bottom: 2px'>\n                        Gym owned by:\n                    </div>\n                    <div>\n                        <b style='color:rgba("+p[b]+")'>Team "+a+"</b><br>\n                        <img height='70px' style='padding: 5px;' src='static/forts/"+a+"_large.png'>\n                    </div>\n                    <div>\n                        "+o+"\n                    </div>\n                    <div>\n                        Level: "+r+" | Prestige: "+c+"/"+(gymPrestige[r-1]||5e4)+"\n                    </div>\n                    <div>\n                        "+j+"\n                    </div>\n                    <div>\n                        Location: "+d.toFixed(6)+", "+e.toFixed(7)+"\n                    </div>\n                    <div>\n                        Last Scanned: "+l+"\n                    </div>\n                    "+n+"\n                </center>\n            </div>"}return q}function getGymLevel(a){for(var b=1;a>=gymPrestige[b-1];)b++;return b}function pokestopLabel(a,b,c){var d;if(a){var e=new Date(a);d="\n            <div>\n                <b>Lured Pokéstop</b>\n            </div>\n            <div>\n                Lure expires at "+pad(e.getHours())+":"+pad(e.getMinutes())+":"+pad(e.getSeconds())+"\n                <span class='label-countdown' disappears-at='"+a+"'>(00m00s)</span>\n            </div>\n            <div>\n                Location: "+b.toFixed(6)+", "+c.toFixed(7)+"\n            </div>\n            <div>\n                <a href='javascript:void(0);' onclick='javascript:openMapDirections("+b+","+c+");' title='View in Maps'>Get directions</a>\n            </div>"}else d="\n            <div>\n                <b>Pokéstop</b>\n            </div>\n            <div>\n                Location: "+b.toFixed(6)+", "+c.toFixed(7)+"\n            </div>\n            <div>\n                <a href='javascript:void(0);' onclick='javascript:openMapDirections("+b+","+c+");' title='View in Maps'>Get directions</a>\n            </div>";return d}function formatSpawnTime(a){return("0"+Math.floor((a+3600)%3600/60)).substr(-2)+":"+("0"+a%60).substr(-2)}function spawnpointLabel(a){var b="\n        <div>\n            <b>Spawn Point</b>\n        </div>\n        <div>\n            Every hour from "+formatSpawnTime(a.time)+" to "+formatSpawnTime(a.time+900)+"\n        </div>";return a.special&&(b+="\n            <div>\n                May appear as early as "+formatSpawnTime(a.time-1800)+"\n            </div>"),b}function addRangeCircle(a,b,c,d){var e=null,f=new google.maps.LatLng(a.position.lat(),a.position.lng()),g=["#999999","#0051CF","#FF260E","#FECC23"],h=g[0];d&&(h=g[d]);var i,j;switch(c){case"pokemon":j="#C233F2",i=40;break;case"pokestop":j="#3EB0FF",i=40;break;case"gym":j=h,i=40}b&&(e=b);var k={map:e,radius:i,strokeWeight:1,strokeColor:j,strokeOpacity:.9,center:f,fillColor:j,fillOpacity:.3},l=new google.maps.Circle(k);return l}function isRangeActive(a){return!(a.getZoom()<16)&&Store.get("showRanges")}function getIv(a,b,c){return null!==a&&100*(a+b+c)/45}function lpad(a,b,c){return Array(Math.max(b-String(a).length+1,0)).join(c)+a}function repArray(a,b,c){for(var d=0;d<b.length;d++)a=a.replace(b[d],c[d]);return a}function getTimeUntil(a){var b=+new Date,c=a-b,d=Math.floor(c/1e3%60),e=Math.floor(c/1e3/60%60),f=Math.floor(c/36e5%24);return{total:c,hour:f,min:e,sec:d,now:b,ttime:a}}function getNotifyText(a){var b=getIv(a.individual_attack,a.individual_defense,a.individual_stamina),c=["<prc>","<pkm>","<atk>","<def>","<sta>"],d=[b?b.toFixed(1):"",a.pokemon_name,a.individual_attack,a.individual_defense,a.individual_stamina],e=repArray(b?notifyIvTitle:notifyNoIvTitle,c,d),f=new Date(a.disappear_time).toLocaleString([],{hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}),g=getTimeUntil(a.disappear_time),h=g.hour>0?g.hour+":":"";h+=lpad(g.min,2,0)+"m"+lpad(g.sec,2,0)+"s",c=["<dist>","<udist>"],d=[f,h];var i=repArray(notifyText,c,d);return{fav_title:e,fav_text:i}}function customizePokemonMarker(a,b,c){if(a.addListener("click",function(){this.setAnimation(null),this.animationDisabled=!0}),!a.rangeCircle&&isRangeActive(map)&&(a.rangeCircle=addRangeCircle(a,map,"pokemon")),a.infoWindow=new google.maps.InfoWindow({content:pokemonLabel(b.pokemon_name,b.pokemon_rarity,b.pokemon_types,b.disappear_time,b.pokemon_id,b.latitude,b.longitude,b.encounter_id,b.individual_attack,b.individual_defense,b.individual_stamina,b.move_1,b.move_2),disableAutoPan:!0}),(notifiedPokemon.indexOf(b.pokemon_id)>-1||notifiedRarity.indexOf(b.pokemon_rarity)>-1)&&(c||(Store.get("playSound")&&audio.play(),sendNotification(getNotifyText(b).fav_title,getNotifyText(b).fav_text,"static/icons/"+b.pokemon_id+".png",b.latitude,b.longitude)),a.animationDisabled!==!0&&a.setAnimation(google.maps.Animation.BOUNCE)),null!=b.individual_attack){var d=getIv(b.individual_attack,b.individual_defense,b.individual_stamina);notifiedMinPerfection>0&&d>=notifiedMinPerfection&&(c||(Store.get("playSound")&&audio.play(),sendNotification(getNotifyText(b).fav_title,getNotifyText(b).fav_text,"static/icons/"+b.pokemon_id+".png",b.latitude,b.longitude)),a.animationDisabled!==!0&&a.setAnimation(google.maps.Animation.BOUNCE))}addListeners(a)}function setupGymMarker(a){var b=new google.maps.Marker({position:{lat:a.latitude,lng:a.longitude},map:map,icon:{url:"static/forts/"+Store.get("gymMarkerStyle")+"/"+gymTypes[a.team_id]+(0!==a.team_id?"_"+getGymLevel(a.gym_points):"")+".png",scaledSize:new google.maps.Size(48,48)}});return!b.rangeCircle&&isRangeActive(map)&&(b.rangeCircle=addRangeCircle(b,map,"gym",a.team_id)),b.infoWindow=new google.maps.InfoWindow({content:gymLabel(gymTypes[a.team_id],a.team_id,a.gym_points,a.latitude,a.longitude,a.last_scanned,a.name,a.pokemon,a.gym_id),disableAutoPan:!0}),Store.get("useGymSidebar")?(b.addListener("click",function(){var b=document.querySelector("#gym-details");b.getAttribute("data-id")===a.gym_id&&b.classList.contains("visible")?b.classList.remove("visible"):(b.setAttribute("data-id",a.gym_id),showGymDetails(a.gym_id))}),google.maps.event.addListener(b.infoWindow,"closeclick",function(){b.persist=null}),isMobileDevice()||isTouchDevice()||b.addListener("mouseover",function(){b.infoWindow.open(map,b),clearSelection(),updateLabelDiffTime()}),b.addListener("mouseout",function(){b.persist||b.infoWindow.close()})):addListeners(b),b}function updateGymMarker(a,b){return b.setIcon({url:"static/forts/"+Store.get("gymMarkerStyle")+"/"+gymTypes[a.team_id]+(0!==a.team_id?"_"+getGymLevel(a.gym_points):"")+".png",scaledSize:new google.maps.Size(48,48)}),b.infoWindow.setContent(gymLabel(gymTypes[a.team_id],a.team_id,a.gym_points,a.latitude,a.longitude,a.last_scanned,a.name,a.pokemon,a.gym_id)),b}function updateGymIcons(){$.each(mapData.gyms,function(a,b){mapData.gyms[a].marker.setIcon({url:"static/forts/"+Store.get("gymMarkerStyle")+"/"+gymTypes[mapData.gyms[a].team_id]+(0!==mapData.gyms[a].team_id?"_"+getGymLevel(mapData.gyms[a].gym_points):"")+".png",scaledSize:new google.maps.Size(48,48)})})}function setupPokestopMarker(a){var b=a.lure_expiration?"PstopLured":"Pstop",c=new google.maps.Marker({position:{lat:a.latitude,lng:a.longitude},map:map,zIndex:2,icon:"static/forts/"+b+".png"});return!c.rangeCircle&&isRangeActive(map)&&(c.rangeCircle=addRangeCircle(c,map,"pokestop")),c.infoWindow=new google.maps.InfoWindow({content:pokestopLabel(a.lure_expiration,a.latitude,a.longitude),disableAutoPan:!0}),addListeners(c),c}function getColorByDate(a){var b=(Date.now()-a)/1e3/60/15;b>1&&(b=1);var c=(120*(1-b)).toString(10);return["hsl(",c,",100%,50%)"].join("")}function setupScannedMarker(a){var b=new google.maps.LatLng(a.latitude,a.longitude),c=new google.maps.Circle({map:map,clickable:!1,center:b,radius:70,fillColor:getColorByDate(a.last_modified),fillOpacity:.1,strokeWeight:1,strokeOpacity:.5});return c}function getColorBySpawnTime(a){var b=new Date,c=60*b.getMinutes()+b.getSeconds();c<900&&a>2700?c+=3600:c>2700&&a<900&&(a+=3600);var d=c-a,e=275;return d>=0&&d<=900?e=120*(1-d/60/15):d<0&&d>-300&&(e=50*(1- -d/60/5)+200),e=5*Math.round(e/5)}function changeSpawnIcon(a,b){var c="";c=275===a?"./static/icons/hsl-275-light.png":"./static/icons/hsl-"+a+".png";var d=1.6,e=1,f=Math.round(d*(b-10));f<e&&(f=e);var g={url:c,scaledSize:new google.maps.Size(f,f),anchor:new google.maps.Point(f/2,f/2)};return g}function spawnPointIndex(a){var b=1,c=0;return a>=0&&a<=120?(c=a/120,b=100+100*c):a>=200&&a<=250&&(c=(a-200)/50,b=100*c),b}function setupSpawnpointMarker(a){var b=new google.maps.LatLng(a.latitude,a.longitude),c=getColorBySpawnTime(a.time),d=map.getZoom(),e=new google.maps.Marker({map:map,position:b,icon:changeSpawnIcon(c,d),zIndex:spawnPointIndex(c)});return e.infoWindow=new google.maps.InfoWindow({content:spawnpointLabel(a),disableAutoPan:!0,position:b}),addListeners(e),e}function clearSelection(){document.selection?document.selection.empty():window.getSelection&&window.getSelection().removeAllRanges()}function addListeners(a){return a.addListener("click",function(){a.infoWindowIsOpen?(a.persist=null,a.infoWindow.close(),a.infoWindowIsOpen=!1):(a.infoWindow.open(map,a),clearSelection(),updateLabelDiffTime(),a.persist=!0,a.infoWindowIsOpen=!0)}),google.maps.event.addListener(a.infoWindow,"closeclick",function(){a.persist=null}),isMobileDevice()||isTouchDevice()||a.addListener("mouseover",function(){a.infoWindow.open(map,a),clearSelection(),updateLabelDiffTime()}),a.addListener("mouseout",function(){a.persist||a.infoWindow.close()}),a}function clearStaleMarkers(){$.each(mapData.pokemons,function(a,b){(mapData.pokemons[a].disappear_time<(new Date).getTime()||excludedPokemon.indexOf(mapData.pokemons[a].pokemon_id)>=0)&&(mapData.pokemons[a].marker.rangeCircle&&(mapData.pokemons[a].marker.rangeCircle.setMap(null),delete mapData.pokemons[a].marker.rangeCircle),mapData.pokemons[a].marker.setMap(null),delete mapData.pokemons[a])}),$.each(mapData.lurePokemons,function(a,b){(mapData.lurePokemons[a].lure_expiration<(new Date).getTime()||excludedPokemon.indexOf(mapData.lurePokemons[a].pokemon_id)>=0)&&(mapData.lurePokemons[a].marker.setMap(null),delete mapData.lurePokemons[a])}),$.each(mapData.scanned,function(a,b){mapData.scanned[a].last_modified<(new Date).getTime()-9e5&&(mapData.scanned[a].marker.setMap(null),delete mapData.scanned[a])})}function showInBoundsMarkers(a,b){$.each(a,function(c,d){var e=a[c].marker,f=!1;a[c].hidden||("function"==typeof e.getBounds?map.getBounds().intersects(e.getBounds())&&(f=!0):"function"==typeof e.getPosition&&map.getBounds().contains(e.getPosition())&&(f=!0)),f&&rangeMarkers.indexOf(b)!==-1&&(e.rangeCircle?isRangeActive(map)?e.rangeCircle.setMap(map):e.rangeCircle.setMap(null):isRangeActive(map)&&("gym"===b?e.rangeCircle=addRangeCircle(e,map,b,a[c].team_id):e.rangeCircle=addRangeCircle(e,map,b))),f&&!e.getMap()?(e.setMap(map),e.setAnimation&&e.oldAnimation&&e.setAnimation(e.oldAnimation)):!f&&e.getMap()&&(e.getAnimation&&(e.oldAnimation=e.getAnimation()),e.rangeCircle&&e.rangeCircle.setMap(null),e.setMap(null))})}function loadRawData(){var a=Store.get("showPokemon"),b=Store.get("showGyms"),c=Store.get("showPokestops"),d=Store.get("showScanned"),e=Store.get("showSpawnpoints"),f=Boolean(Store.get("showLuredPokestopsOnly")),g=map.getBounds(),h=g.getSouthWest(),i=g.getNorthEast(),j=h.lat(),k=h.lng(),l=i.lat(),m=i.lng();return $.ajax({url:"raw_data.php",type:"GET",data:{timestamp:timestamp,pokemon:a,lastpokemon:lastpokemon,pokestops:c,lastpokestops:lastpokestops,luredonly:f,gyms:b,lastgyms:lastgyms,scanned:d,lastslocs:lastslocs,spawnpoints:e,lastspawns:lastspawns,swLat:j,swLng:k,neLat:l,neLng:m,oSwLat:oSwLat,oSwLng:oSwLng,oNeLat:oNeLat,oNeLng:oNeLng,reids:String(reincludedPokemon),eids:String(excludedPokemon)},dataType:"json",cache:!1,beforeSend:function a(){return!rawDataIsLoading&&void(rawDataIsLoading=!0)},error:function a(){if($timeoutDialog)$timeoutDialog.dialog("isOpen")||$timeoutDialog.dialog("open");else{var b={title:"Reduce marker settings"};$timeoutDialog=$("<div>Hmm... we're having problems getting data for your criteria. Try reducing what you're showing and zooming in to limit what's returned.</div>").dialog(b),$timeoutDialog.dialog("open")}},complete:function a(){rawDataIsLoading=!1}})}function processPokemons(a,b){return!!Store.get("showPokemon")&&void(!(b.encounter_id in mapData.pokemons)&&excludedPokemon.indexOf(b.pokemon_id)<0&&b.disappear_time>Date.now()&&(b.marker&&b.marker.setMap(null),b.hidden||(b.marker=setupPokemonMarker(b,map),customizePokemonMarker(b.marker,b),mapData.pokemons[b.encounter_id]=b)))}function processPokestops(a,b){if(!Store.get("showPokestops"))return!1;if(Store.get("showLuredPokestopsOnly")&&!b.lure_expiration)return!0;if(mapData.pokestops[b.pokestop_id]){var c=mapData.pokestops[b.pokestop_id];!!b.lure_expiration!=!!c.lure_expiration&&(c.marker&&c.marker.rangeCircle&&c.marker.rangeCircle.setMap(null),c.marker.setMap(null),b.marker=setupPokestopMarker(b),mapData.pokestops[b.pokestop_id]=b)}else b.marker&&b.marker.rangeCircle&&b.marker.rangeCircle.setMap(null),b.marker&&b.marker.setMap(null),b.marker=setupPokestopMarker(b),mapData.pokestops[b.pokestop_id]=b}function updatePokestops(){if(!Store.get("showPokestops"))return!1;var a=[],b=(new Date).getTime();$.each(mapData.pokestops,function(a,c){c.lure_expiration&&c.lure_expiration<b&&(c.lure_expiration=null,c.marker&&c.marker.rangeCircle&&c.marker.rangeCircle.setMap(null),c.marker.setMap(null),c.marker=setupPokestopMarker(c))}),Store.get("showLuredPokestopsOnly")&&($.each(mapData.pokestops,function(b,c){c.lure_expiration||a.push(b)}),$.each(a,function(a,b){mapData.pokestops[b]&&mapData.pokestops[b].marker&&(mapData.pokestops[b].marker.rangeCircle&&mapData.pokestops[b].marker.rangeCircle.setMap(null),mapData.pokestops[b].marker.setMap(null),delete mapData.pokestops[b])}))}function processGyms(a,b){if(!Store.get("showGyms"))return!1;var c=getGymLevel(b.gym_points),d=function a(b){mapData.gyms[b]&&mapData.gyms[b].marker&&(mapData.gyms[b].marker.rangeCircle&&mapData.gyms[b].marker.rangeCircle.setMap(null),mapData.gyms[b].marker.setMap(null),delete mapData.gyms[b])},e=function a(c,d){return c>b.pokemon.length&&0!==b.pokemon.length};if(1===Store.get("showOpenGymsOnly")&&!e(c,b.pokemon.length))return d(b.gym_id),!0;if(Store.get("showOpenGymsOnly")>1){var f=0;switch(Store.get("showOpenGymsOnly")){case 2:f=1e3;break;case 3:f=2500;break;case 4:f=5e3}if(!e(c,b.pokemon.length)&&(gymPrestige[c-1]>f+b.gym_points||10===c))return d(b.gym_id),!0}if(Store.get("showTeamGymsOnly")&&Store.get("showTeamGymsOnly")!==b.team_id)return d(b.gym_id),!0;if(Store.get("showLastUpdatedGymsOnly")){var g=new Date;if(3600*Store.get("showLastUpdatedGymsOnly")*1e3+b.last_scanned<g.getTime())return d(b.gym_id),!0}return c<Store.get("minGymLevel")?(d(b.gym_id),!0):c>Store.get("maxGymLevel")?(d(b.gym_id),!0):(b.gym_id in mapData.gyms?b.marker=updateGymMarker(b,mapData.gyms[b.gym_id].marker):b.marker=setupGymMarker(b),void(mapData.gyms[b.gym_id]=b))}function processScanned(a,b){if(!Store.get("showScanned"))return!1;var c=b.latitude+"|"+b.longitude;c in mapData.scanned?mapData.scanned[c].last_modified=b.last_modified:(b.marker&&b.marker.setMap(null),b.marker=setupScannedMarker(b),mapData.scanned[c]=b)}function updateScanned(){return!!Store.get("showScanned")&&void $.each(mapData.scanned,function(a,b){map.getBounds().intersects(b.marker.getBounds())&&b.marker.setOptions({fillColor:getColorByDate(b.last_modified)})})}function processSpawnpoints(a,b){if(!Store.get("showSpawnpoints"))return!1;var c=b.spawnpoint_id;c in mapData.spawnpoints||(b.marker&&b.marker.setMap(null),b.marker=setupSpawnpointMarker(b),mapData.spawnpoints[c]=b)}function updateSpawnPoints(){if(!Store.get("showSpawnpoints"))return!1;var a=map.getZoom();$.each(mapData.spawnpoints,function(b,c){if(map.getBounds().contains(c.marker.getPosition())){var d=getColorBySpawnTime(c.time);c.marker.setIcon(changeSpawnIcon(d,a)),c.marker.setZIndex(spawnPointIndex(d))}})}function updateMap(){loadRawData().done(function(a){$.each(a.pokemons,processPokemons),$.each(a.pokestops,processPokestops),$.each(a.gyms,processGyms),$.each(a.scanned,processScanned),$.each(a.spawnpoints,processSpawnpoints),showInBoundsMarkers(mapData.pokemons,"pokemon"),showInBoundsMarkers(mapData.lurePokemons,"pokemon"),showInBoundsMarkers(mapData.gyms,"gym"),showInBoundsMarkers(mapData.pokestops,"pokestop"),showInBoundsMarkers(mapData.scanned,"scanned"),showInBoundsMarkers(mapData.spawnpoints,"inbound"),clearStaleMarkers(),updateScanned(),updateSpawnPoints(),updatePokestops(),$("#stats").hasClass("visible")&&countMarkers(map),oSwLat=a.oSwLat,oSwLng=a.oSwLng,oNeLat=a.oNeLat,oNeLng=a.oNeLng,lastgyms=a.lastgyms,lastpokestops=a.lastpokestops,lastpokemon=a.lastpokemon,lastslocs=a.lastslocs,lastspawns=a.lastspawns,reids=a.reids,reids instanceof Array&&(reincludedPokemon=reids.filter(function(a){return this.indexOf(a)<0},reincludedPokemon)),timestamp=a.timestamp,lastUpdateTime=Date.now()})}function drawScanPath(a){var b=[];$.each(a,function(a,c){b.push({lat:c.latitude,lng:c.longitude})}),scanPath&&scanPath.setMap(null),scanPath=new google.maps.Polyline({path:b,geodesic:!0,strokeColor:"#FF0000",strokeOpacity:1,strokeWeight:2,map:map})}function redrawPokemon(a){var b=!0;$.each(a,function(c,d){var e=a[c];if(!e.hidden){e.marker.rangeCircle&&e.marker.rangeCircle.setMap(null);var f=setupPokemonMarker(e,map,this.marker.animationDisabled);customizePokemonMarker(f,e,b),e.marker.setMap(null),a[c].marker=f}})}function getPointDistance(a,b){return google.maps.geometry.spherical.computeDistanceBetween(a,b)}function sendNotification(a,b,c,d,e){if(!("Notification"in window))return!1;if("granted"!==Notification.permission)Notification.requestPermission();else{var f=new Notification(a,{icon:c,body:b,sound:"sounds/ding.mp3"});f.onclick=function(){window.focus(),f.close(),centerMap(d,e,20)}}}function createMyLocationButton(){var a=document.createElement("div"),b=document.createElement("button");b.style.backgroundColor="#fff",b.style.border="none",b.style.outline="none",b.style.width="28px",b.style.height="28px",b.style.borderRadius="2px",b.style.boxShadow="0 1px 4px rgba(0,0,0,0.3)",b.style.cursor="pointer",b.style.marginRight="10px",b.style.padding="0px",b.title="My Location",a.appendChild(b);var c=document.createElement("div");c.style.margin="5px",c.style.width="18px",c.style.height="18px",c.style.backgroundImage="url(static/mylocation-sprite-1x.png)",c.style.backgroundSize="180px 18px",c.style.backgroundPosition="0px 0px",c.style.backgroundRepeat="no-repeat",c.id="current-location",b.appendChild(c),b.addEventListener("click",function(){centerMapOnLocation()}),a.index=1,map.controls[google.maps.ControlPosition.RIGHT_BOTTOM].push(a),google.maps.event.addListener(map,"dragend",function(){var a=document.getElementById("current-location");a.style.backgroundPosition="0px 0px"})}function centerMapOnLocation(){var a=document.getElementById("current-location"),b="0",c=setInterval(function(){b="-18"===b?"0":"-18",a.style.backgroundPosition=b+"px 0"},500);navigator.geolocation?navigator.geolocation.getCurrentPosition(function(b){var d=new google.maps.LatLng(b.coords.latitude,b.coords.longitude);locationMarker.setPosition(d),map.setCenter(d),Store.set("followMyLocationPosition",{lat:b.coords.latitude,lng:b.coords.longitude}),clearInterval(c),a.style.backgroundPosition="-144px 0px"}):(clearInterval(c),a.style.backgroundPosition="0px 0px")}function changeLocation(a,b){var c=new google.maps.LatLng(a,b);changeSearchLocation(a,b).done(function(){map.setCenter(c),searchMarker.setPosition(c)})}function changeSearchLocation(a,b){return $.post("next_loc?lat="+a+"&lon="+b,{})}function centerMap(a,b,c){var d=new google.maps.LatLng(a,b);map.setCenter(d),c&&(storeZoom=!1,map.setZoom(c))}function i8ln(a){return $.isEmptyObject(i8lnDictionary)&&"en"!==language&&languageLookups<languageLookupThreshold&&$.ajax({url:"static/dist/locales/"+language+".min.json",dataType:"json",async:!1,success:function a(b){i8lnDictionary=b},error:function a(b,c,d){console.log("Error loading i8ln dictionary: "+d),languageLookups++}}),a in i8lnDictionary?i8lnDictionary[a]:a}function updateGeoLocation(){navigator.geolocation&&(Store.get("geoLocate")||Store.get("followMyLocation"))&&navigator.geolocation.getCurrentPosition(function(a){var b=a.coords.latitude,c=a.coords.longitude,d=new google.maps.LatLng(b,c);Store.get("geoLocate")&&"undefined"!=typeof searchMarker&&getPointDistance(searchMarker.getPosition(),d)>40&&$.post("next_loc?lat="+b+"&lon="+c).done(function(){map.panTo(d),searchMarker.setPosition(d)}),Store.get("followMyLocation")&&"undefined"!=typeof locationMarker&&getPointDistance(locationMarker.getPosition(),d)>=5&&(map.panTo(d),locationMarker.setPosition(d),Store.set("followMyLocationPosition",{lat:b,lng:c}))})}function createUpdateWorker(){try{if(isMobileDevice()&&window.Worker){var a=new Blob(["onmessage = function(e) {\n                var data = e.data\n                if (data.name === 'backgroundUpdate') {\n                    self.setInterval(function () {self.postMessage({name: 'backgroundUpdate'})}, 5000)\n                }\n            }"]),b=window.URL.createObjectURL(a);updateWorker=new Worker(b),updateWorker.onmessage=function(a){var b=a.data;document.hidden&&"backgroundUpdate"===b.name&&Date.now()-lastUpdateTime>2500&&(updateMap(),updateGeoLocation())},updateWorker.postMessage({name:"backgroundUpdate"})}}catch(a){console.log("Webworker error: "+a.message)}}function showGymDetails(a){var b=document.querySelector("#gym-details"),c;b.classList.add("visible");var d=$.ajax({url:"gym_data",type:"GET",data:{id:a},dataType:"json",cache:!1});d.done(function(a){var d=getGymLevel(a.gym_points),e=gymPrestige[d-1]||5e4,f=a.gym_points/e*100,g=new Date(a.last_scanned),h=a.pokemon.length?d-a.pokemon.length:0,i=h?" - "+h+" Free Slots":"",j="";
j=0===a.team_id?'\n                <center class="team-'+a.team_id+'-text">\n                    <b class="team-'+a.team_id+'-text">Uncontested - 1 Free Slot</b>\n                </center>':'<div>\n                <b class="team-'+a.team_id+'-text">Level '+d+i+"</b>\n            </div>";var k="",l='\n            <center class="team-'+a.team_id+'-text">\n                <div>\n                    <b class="team-'+a.team_id+'-text">'+(a.name||"")+'</b>\n                </div>\n                <img height="100px" style="padding: 5px;" src="static/forts/'+gymTypes[a.team_id]+'_large.png">\n                <div class="prestige-bar team-'+a.team_id+'">\n                    <div class="prestige team-'+a.team_id+'" style="width: '+f+'%">\n                    </div>\n                </div>\n                <div>\n                    '+a.gym_points+"/"+e+"\n                </div>\n                "+j+'\n                <div style="font-size: .7em;">\n                    Last Scanned: '+g.getFullYear()+"-"+pad(g.getMonth()+1)+"-"+pad(g.getDate())+" "+pad(g.getHours())+":"+pad(g.getMinutes())+":"+pad(g.getSeconds())+"\n                </div>\n                <div>\n                    <a href='javascript:void(0);' onclick='javascript:openMapDirections("+a.latitude+","+a.longitude+");' title='View in Maps'>Get directions</a>\n                </div>\n            </center>\n        ";a.pokemon.length?($.each(a.pokemon,function(b,c){var d=getIv(c.iv_attack,c.iv_defense,c.iv_stamina),e=Math.round(100/c.move_2_energy);k+='\n                    <tr onclick=toggleGymPokemonDetails(this)>\n                        <td width="30px">\n                            <i class="pokemon-sprite n'+c.pokemon_id+'"></i>\n                        </td>\n                        <td class="team-'+a.team_id+'-text">\n                            <div style="line-height:1em;">'+c.pokemon_name+'</div>\n                            <div class="cp">CP '+c.pokemon_cp+'</div>\n                        </td>\n                        <td width="190" class="team-'+a.team_id+'-text" align="center">\n                            <div class="trainer-level">'+c.trainer_level+'</div>\n                            <div style="line-height: 1em;">'+c.trainer_name+'</div>\n                        </td>\n                        <td width="10">\n                            <!--<a href="#" onclick="toggleGymPokemonDetails(this)">-->\n                                <i class="team-'+a.team_id+'-text fa fa-angle-double-down"></i>\n                            <!--</a>-->\n                        </td>\n                    </tr>\n                    <tr class="details">\n                        <td colspan="2">\n                            <div class="ivs">\n                                <div class="iv">\n                                    <div class="type">ATK</div>\n                                    <div class="value">\n                                        '+c.iv_attack+'\n                                    </div>\n                                </div>\n                                <div class="iv">\n                                    <div class="type">DEF</div>\n                                    <div class="value">\n                                        '+c.iv_defense+'\n                                    </div>\n                                </div>\n                                <div class="iv">\n                                    <div class="type">STA</div>\n                                    <div class="value">\n                                        '+c.iv_stamina+'\n                                    </div>\n                                </div>\n                                <div class="iv" style="width: 36px;"">\n                                    <div class="type">PERFECT</div>\n                                    <div class="value">\n                                        '+d.toFixed(0)+'<span style="font-size: .6em;">%</span>\n                                    </div>\n                                </div>\n                            </div>\n                        </td>\n                        <td colspan="2">\n                            <div class="moves">\n                                <div class="move">\n                                    <div class="name">\n                                        '+c.move_1_name+'\n                                        <div class="type '+c.move_1_type.type_en.toLowerCase()+'">'+c.move_1_type.type+'</div>\n                                    </div>\n                                    <div class="damage">\n                                        '+c.move_1_damage+'\n                                    </div>\n                                </div>\n                                <br>\n                                <div class="move">\n                                    <div class="name">\n                                        '+c.move_2_name+'\n                                        <div class="type '+c.move_2_type.type_en.toLowerCase()+'">'+c.move_2_type.type+'</div>\n                                        <div>\n                                            <i class="move-bar-sprite move-bar-sprite-'+e+'"></i>\n                                        </div>\n                                    </div>\n                                    <div class="damage">\n                                        '+c.move_2_damage+"\n                                    </div>\n                                </div>\n                            </div>\n                        </td>\n                    </tr>\n                    "}),k="<table><tbody>"+k+"</tbody></table>"):k=0===a.team_id?"":'\n                <center class="team-'+a.team_id+'-text">\n                    Gym Leader:<br>\n                    <i class="pokemon-large-sprite n'+a.guard_pokemon_id+'"></i><br>\n                    <b class="team-'+a.team_id+'-text">'+a.guard_pokemon_name+'</b>\n\n                    <p style="font-size: .75em; margin: 5px;">\n                        No additional gym information is available for this gym. Make sure you are collecting <a href="https://pgm.readthedocs.io/en/develop/extras/gyminfo.html">detailed gym info.</a>\n                        If you have detailed gym info collection running, this gym\'s Pokemon information may be out of date.\n                    </p>\n                </center>\n            ',b.innerHTML=""+l+k,c=document.createElement("a"),c.href="#",c.className="close",c.tabIndex=0,b.appendChild(c),c.addEventListener("click",function(a){a.preventDefault(),a.stopPropagation(),b.classList.remove("visible")})})}function toggleGymPokemonDetails(a){a.lastElementChild.firstElementChild.classList.toggle("fa-angle-double-up"),a.lastElementChild.firstElementChild.classList.toggle("fa-angle-double-down"),a.nextElementSibling.classList.toggle("visible")}var $selectExclude,$selectPokemonNotify,$selectRarityNotify,$textPerfectionNotify,$selectStyle,$selectIconSize,$selectOpenGymsOnly,$selectTeamGymsOnly,$selectLastUpdateGymsOnly,$selectMinGymLevel,$selectMaxGymLevel,$selectLuredPokestopsOnly,$selectSearchIconMarker,$selectGymMarkerStyle,$selectLocationIconMarker,$switchGymSidebar,$timeoutDialog,language=""===document.documentElement.lang?"en":document.documentElement.lang,idToPokemon={},i8lnDictionary={},languageLookups=0,languageLookupThreshold=3,searchMarkerStyles,timestamp,excludedPokemon=[],notifiedPokemon=[],notifiedRarity=[],notifiedMinPerfection=null,buffer=[],reincludedPokemon=[],reids=[],map,rawDataIsLoading=!1,locationMarker,rangeMarkers=["pokemon","pokestop","gym"],searchMarker,storeZoom=!0,scanPath,moves,oSwLat,oSwLng,oNeLat,oNeLng,lastpokestops,lastgyms,lastpokemon,lastslocs,lastspawns,selectedStyle="light",updateWorker,lastUpdateTime,gymTypes=["Uncontested","Mystic","Valor","Instinct"],gymPrestige=[2e3,4e3,8e3,12e3,16e3,2e4,3e4,4e4,5e4],audio=new Audio("static/sounds/ding.mp3"),notifyIvTitle="<pkm> <prc>% (<atk>/<def>/<sta>)",notifyNoIvTitle="<pkm>",notifyText="disappears at <dist> (<udist>)",searchControlURI="search_control",updateLabelDiffTime=function a(){$(".label-countdown").each(function(a,b){var c=getTimeUntil(parseInt(b.getAttribute("disappears-at"))),d=c.hour,e=c.min,f=c.sec,g="";c.ttime<c.now?g="(expired)":(g="(",d>0&&(g=d+"h"),g+=lpad(e,2,0)+"m",g+=lpad(f,2,0)+"s",g+=")"),$(b).text(g)})};$(function(){return Notification?void("granted"!==Notification.permission&&Notification.requestPermission()):void console.log("could not load notifications")}),$(function(){$selectStyle=$("#map-style"),$.getJSON("static/dist/data/mapstyle.min.json").done(function(a){var b=[];$.each(a,function(a,c){b.push({id:a,text:i8ln(c)})}),$selectStyle.select2({placeholder:"Select Style",data:b,minimumResultsForSearch:1/0}),$selectStyle.on("change",function(a){selectedStyle=$selectStyle.val(),map.setMapTypeId(selectedStyle),Store.set("map_style",selectedStyle)}),$selectStyle.val(Store.get("map_style")).trigger("change")}),$selectIconSize=$("#pokemon-icon-size"),$selectIconSize.select2({placeholder:"Select Icon Size",minimumResultsForSearch:1/0}),$selectIconSize.on("change",function(){Store.set("iconSizeModifier",this.value),redrawPokemon(mapData.pokemons),redrawPokemon(mapData.lurePokemons)}),$selectOpenGymsOnly=$("#open-gyms-only-switch"),$selectOpenGymsOnly.select2({placeholder:"Only Show Open Gyms",minimumResultsForSearch:1/0}),$selectOpenGymsOnly.on("change",function(){Store.set("showOpenGymsOnly",this.value),lastgyms=!1,updateMap()}),$selectTeamGymsOnly=$("#team-gyms-only-switch"),$selectTeamGymsOnly.select2({placeholder:"Only Show Gyms For Team",minimumResultsForSearch:1/0}),$selectTeamGymsOnly.on("change",function(){Store.set("showTeamGymsOnly",this.value),lastgyms=!1,updateMap()}),$selectLastUpdateGymsOnly=$("#last-update-gyms-switch"),$selectLastUpdateGymsOnly.select2({placeholder:"Only Show Gyms Last Updated",minimumResultsForSearch:1/0}),$selectLastUpdateGymsOnly.on("change",function(){Store.set("showLastUpdatedGymsOnly",this.value),lastgyms=!1,updateMap()}),$selectMinGymLevel=$("#min-level-gyms-filter-switch"),$selectMinGymLevel.select2({placeholder:"Minimum Gym Level",minimumResultsForSearch:1/0}),$selectMinGymLevel.on("change",function(){Store.set("minGymLevel",this.value),lastgyms=!1,updateMap()}),$selectMaxGymLevel=$("#max-level-gyms-filter-switch"),$selectMaxGymLevel.select2({placeholder:"Maximum Gym Level",minimumResultsForSearch:1/0}),$selectMaxGymLevel.on("change",function(){Store.set("maxGymLevel",this.value),lastgyms=!1,updateMap()}),$selectLuredPokestopsOnly=$("#lured-pokestops-only-switch"),$selectLuredPokestopsOnly.select2({placeholder:"Only Show Lured Pokestops",minimumResultsForSearch:1/0}),$selectLuredPokestopsOnly.on("change",function(){Store.set("showLuredPokestopsOnly",this.value),lastpokestops=!1,updateMap()}),$switchGymSidebar=$("#gym-sidebar-switch"),$switchGymSidebar.on("change",function(){Store.set("useGymSidebar",this.checked),lastgyms=!1,$.each(["gyms"],function(a,b){$.each(mapData[b],function(a,c){mapData[b][a].marker.rangeCircle&&(mapData[b][a].marker.rangeCircle.setMap(null),delete mapData[b][a].marker.rangeCircle),mapData[b][a].marker.setMap(null)}),mapData[b]={}}),updateMap()}),$selectSearchIconMarker=$("#iconmarker-style"),$selectLocationIconMarker=$("#locationmarker-style"),$.getJSON("static/dist/data/searchmarkerstyle.min.json").done(function(a){searchMarkerStyles=a;var b=[];$.each(a,function(a,c){b.push({id:a,text:c.name})}),$selectSearchIconMarker.select2({placeholder:"Select Icon Marker",data:b,minimumResultsForSearch:1/0}),$selectSearchIconMarker.on("change",function(a){var b=$selectSearchIconMarker.val();Store.set("searchMarkerStyle",b),updateSearchMarker(b)}),$selectSearchIconMarker.val(Store.get("searchMarkerStyle")).trigger("change"),updateSearchMarker(Store.get("lockMarker")),$selectLocationIconMarker.select2({placeholder:"Select Location Marker",data:b,minimumResultsForSearch:1/0}),$selectLocationIconMarker.on("change",function(a){Store.set("locationMarkerStyle",this.value),updateLocationMarker(this.value)}),$selectLocationIconMarker.val(Store.get("locationMarkerStyle")).trigger("change")}),$selectGymMarkerStyle=$("#gym-marker-style"),$selectGymMarkerStyle.select2({placeholder:"Select Style",minimumResultsForSearch:1/0}),$selectGymMarkerStyle.on("change",function(a){Store.set("gymMarkerStyle",this.value),updateGymIcons()}),$selectGymMarkerStyle.val(Store.get("gymMarkerStyle")).trigger("change")}),$(function(){function a(a){if(!a.id)return a.text;var b=$('<span><i class="pokemon-sprite n'+a.element.value.toString()+'"></i> '+a.text+"</span>");return b}function b(a,b,c){return function(){Store.set(c,this.checked),this.checked?("showPokemon"===c?lastpokemon=!1:"showGyms"===c?lastgyms=!1:"showPokestops"===c?lastpokestops=!1:"showScanned"===c?lastslocs=!1:"showSpawnpoints"===c&&(lastspawns=!1),updateMap()):($.each(b,function(b,d){$.each(a[d],function(b,e){a[d][b].marker.rangeCircle&&(a[d][b].marker.rangeCircle.setMap(null),delete a[d][b].marker.rangeCircle),"showRanges"!==c&&a[d][b].marker.setMap(null)}),"showRanges"!==c&&(a[d]={})}),"showRanges"===c&&updateMap())}}Store.get("startAtUserLocation")&&centerMapOnLocation(),$.getJSON("static/dist/data/moves.min.json").done(function(a){moves=a}),$selectExclude=$("#exclude-pokemon"),$selectPokemonNotify=$("#notify-pokemon"),$selectRarityNotify=$("#notify-rarity"),$textPerfectionNotify=$("#notify-perfection");var c=493;$.getJSON("static/dist/data/pokemon.min.json").done(function(b){var d=[];$.each(b,function(a,b){if(a>c)return!1;var e=[];d.push({id:a,text:i8ln(b.name)+" - #"+a}),b.name=i8ln(b.name),b.rarity=i8ln(b.rarity),$.each(b.types,function(a,b){e.push({type:i8ln(b.type),color:b.color})}),b.types=e,idToPokemon[a]=b}),$selectExclude.select2({placeholder:i8ln("Select Pokémon"),data:d,templateResult:a}),$selectPokemonNotify.select2({placeholder:i8ln("Select Pokémon"),data:d,templateResult:a}),$selectRarityNotify.select2({placeholder:i8ln("Select Rarity"),data:[i8ln("Common"),i8ln("Uncommon"),i8ln("Rare"),i8ln("Very Rare"),i8ln("Ultra Rare")],templateResult:a}),$selectExclude.on("change",function(a){buffer=excludedPokemon,excludedPokemon=$selectExclude.val().map(Number),buffer=buffer.filter(function(a){return this.indexOf(a)<0},excludedPokemon),reincludedPokemon=reincludedPokemon.concat(buffer),clearStaleMarkers(),Store.set("remember_select_exclude",excludedPokemon)}),$selectPokemonNotify.on("change",function(a){notifiedPokemon=$selectPokemonNotify.val().map(Number),Store.set("remember_select_notify",notifiedPokemon)}),$selectRarityNotify.on("change",function(a){notifiedRarity=$selectRarityNotify.val().map(String),Store.set("remember_select_rarity_notify",notifiedRarity)}),$textPerfectionNotify.on("change",function(a){notifiedMinPerfection=parseInt($textPerfectionNotify.val(),10),(isNaN(notifiedMinPerfection)||notifiedMinPerfection<=0)&&(notifiedMinPerfection=""),notifiedMinPerfection>100&&(notifiedMinPerfection=100),$textPerfectionNotify.val(notifiedMinPerfection),Store.set("remember_text_perfection_notify",notifiedMinPerfection)}),$selectExclude.val(Store.get("remember_select_exclude")).trigger("change"),$selectPokemonNotify.val(Store.get("remember_select_notify")).trigger("change"),$selectRarityNotify.val(Store.get("remember_select_rarity_notify")).trigger("change"),$textPerfectionNotify.val(Store.get("remember_text_perfection_notify")).trigger("change"),isTouchDevice()&&isMobileDevice()&&$(".select2-search input").prop("readonly",!0)}),window.setInterval(updateLabelDiffTime,1e3),window.setInterval(updateMap,5e3),window.setInterval(updateGeoLocation,1e3),createUpdateWorker(),$("#gyms-switch").change(function(){var a={duration:500},c=$("#gym-sidebar-wrapper");this.checked?(lastgyms=!1,c.show(a)):(lastgyms=!1,c.hide(a));var d=$("#gyms-filter-wrapper");this.checked?(lastgyms=!1,d.show(a)):(lastgyms=!1,d.hide(a)),b(mapData,["gyms"],"showGyms").bind(this)()}),$("#pokemon-switch").change(function(){b(mapData,["pokemons"],"showPokemon").bind(this)()}),$("#scanned-switch").change(function(){b(mapData,["scanned"],"showScanned").bind(this)()}),$("#spawnpoints-switch").change(function(){b(mapData,["spawnpoints"],"showSpawnpoints").bind(this)()}),$("#ranges-switch").change(b(mapData,["gyms","pokemons","pokestops"],"showRanges")),$("#pokestops-switch").change(function(){var a={duration:500},c=$("#lured-pokestops-only-wrapper");return this.checked?(lastpokestops=!1,c.show(a)):(lastpokestops=!1,c.hide(a)),b(mapData,["pokestops"],"showPokestops").bind(this)()}),$("#sound-switch").change(function(){Store.set("playSound",this.checked)}),$("#geoloc-switch").change(function(){$("#next-location").prop("disabled",this.checked),$("#next-location").css("background-color",this.checked?"#e0e0e0":"#ffffff"),navigator.geolocation?Store.set("geoLocate",this.checked):this.checked=!1}),$("#lock-marker-switch").change(function(){Store.set("lockMarker",this.checked),searchMarker.setDraggable(!this.checked)}),$("#search-switch").change(function(){searchControl(this.checked?"on":"off")}),$("#start-at-user-location-switch").change(function(){Store.set("startAtUserLocation",this.checked)}),$("#follow-my-location-switch").change(function(){navigator.geolocation?Store.set("followMyLocation",this.checked):this.checked=!1,locationMarker.setDraggable(!this.checked)}),$("#scan-here-switch").change(function(){this.checked&&!Store.get("scanHereAlerted")&&(alert("Use this feature carefully ! This button will set the current map center as new search location. This may cause worker to teleport long range."),Store.set("scanHereAlerted",!0)),$("#scan-here").toggle(this.checked),Store.set("scanHere",this.checked)}),$("#nav-accordion").length&&$("#nav-accordion").accordion({active:0,collapsible:!0,heightStyle:"content"}),$("#pokemonList_table").DataTable({paging:!1,searching:!1,info:!1,errMode:"throw",language:{emptyTable:""},columns:[{orderable:!1},null,null,null]}).order([1,"asc"])});
//# sourceMappingURL=map.min.js.map